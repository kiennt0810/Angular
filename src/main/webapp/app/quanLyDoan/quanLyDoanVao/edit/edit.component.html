<div *ngIf="doanVao">
    <form name="editForm" (ngSubmit)="createDV()" action="" style="background-color: white;" [formGroup]="editForm">
        <div class="p-4">
            <div class="row" role="form">
                <div class="col-sm-3">
                    <h6>STT đoàn</h6>
                </div>
                <div class="col-sm-9">
                    <input class="form-control" type="text" name="maDoan" formControlName="maDoan" [attr.disabled]="true">
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-sm-3">
                    <h6>Tên đoàn <span class="text-danger">*</span></h6>
                </div>
                <div class="col-sm-9">
                    <input class="form-control" type="text" name="tenDoan" formControlName="tenDoan">
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-sm-3">
                    <h6>Trưởng đoàn <span class="text-danger">*</span></h6>
                </div>
                <div class="col-sm-9">
                    <input class="form-control" type="text" name="truongDoan" formControlName="truongDoan">
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-sm-3">
                    <h6>Quốc gia <span class="text-danger">*</span></h6>
                </div>
                <div class="col-sm-9">
                    <select class="form-select" style="background-color: #fff" name="maQG" formControlName="maQG" (change)="handleChange($event)" maxlength="10">
                        <option value=null default >------- Chọn quốc gia -------</option>
                        <option *ngFor="let item of citems" [value]="item.maQG">{{ item.ten }}</option>
                      </select>
                      <div *ngIf="editForm.get('quocGia')!.invalid && editForm.get('quocGia')!.touched">
                          <small class="form-text text-danger" *ngIf="editForm.get('quocGia')?.errors?.required">
                            Trường này không được để trống.
                          </small>
                      </div>
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-sm-3">
                    <h6>Mục đích hoạt động <span class="text-danger">*</span></h6>
                </div>
                <div class="col-sm-9">
                    <input class="form-control" type="text" name="mucDichHD" formControlName="mucDichHD">
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-sm-3">
                    <h6>Ngày nhập cảnh <span class="text-danger">*</span></h6>
                </div>
                <div class="col-sm-3">
                    <div class="w-30">
                        <input class="form-control" type="text" placeholder="dd/mm/yyyy" bsDatepicker [(bsValue)]="ngayNCChange"
                        [bsConfig]="{ dateInputFormat: 'DD/MM/YYYY', showWeekNumbers: false }" name="ngayNC"
                            formControlName="ngayNC" id="ngayNC" (change)="isInvalidDateNgayNC($event)" (bsValueChange)="checkDateNgayNC($event)"
                            (keypress)=" numberOnlywithForwardSlash($event)" maxlength="10">
                            <div *ngIf="editForm.get('ngayNC')!.invalid && editForm.get('ngayNC')!.touched">
                                <small class="form-text text-danger" *ngIf="editForm.get('ngayNC')?.errors?.required">
                                  Trường này không được để trống.
                                </small>
                            </div>
                    </div>
                </div>
                <div class="col-sm-3">
                    <h6 style="padding-left: 10%;">Ngày xuất cảnh</h6>
                </div>
                <div class="col-sm-3">
                    <div class="w-30 input-group">
                        <input class="form-control" type="text" bsDatepicker [(bsValue)]="ngayXCChange"
                        [bsConfig]="{ dateInputFormat: 'DD/MM/YYYY', showWeekNumbers: false }" name="ngayXC" formControlName="ngayXC" id="ngayXC"
                        (keypress)=" numberOnlywithForwardSlash($event)" (change)="isInvalidDateNgayXC($event)" (bsValueChange)="checkDateNgayXC($event)" maxlength="10"/>
                    </div>
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-sm-3">
                    <h6>Số ngày lưu trú tại Việt Nam</h6>
                </div>
                <div class="col-sm-9">
                    <input style="width: 25%;" class="form-control" type="text" id="soNgay" name="soNgay" formControlName="soNgay">
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-sm-3">
                    <h6>Nơi lưu trú</h6>
                </div>
                <div class="col-sm-9">
                    <input class="form-control" type="text" name="noiLuuTru" formControlName="noiLuuTru">
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-sm-3">
                    <h6>An ninh chăm sóc sức khỏe</h6>
                </div>
                <div class="col-sm-9">
                    <p *ngFor="let d of anNinh">
                        <input type="checkbox" [checked]="d.checked" (change)="d.checked = !d.checked"
                            [checked]="inputChecked(d)" />
                        &nbsp;{{ d.name }}
                    </p>
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-sm-3">
                    <h6>Số lượng thành viên trong đoàn</h6>
                </div>
                <div class="col-sm-3">
                    <input class="form-control" type="text" name="soLuongTV" formControlName="soLuongTV" [attr.disabled]="true"/>
                </div>
                <div class="col-sm-6" style="align-self: center;">
                    <h6>&nbsp;người</h6>
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-sm-3">
                    <h6>Ghi chú</h6>
                </div>
                <div class="col-sm-9">
                    <input class="form-control" type="text" name="ghiChu" formControlName="ghiChu">
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-sm-3">
                    <h6 style="font-weight: bold;">Hồ sơ đính kèm</h6>
                </div>
                <div class="col-sm-9 custom-file-button">
                    <label for="uploadDocument">Tải thêm tệp file không lớn hơn
                        <strong>100 MB</strong></label>
                    <mat-chip-list #chipList>
                        <input type="file" multiple #uploadFile (change)="handleFileInput($event)" formControlName="listFile" id="inputGroupFile"
                            [matChipInputFor]="chipList" >
                            <label class="input-group-text label-cus mt-1" for="inputGroupFile">Tải tập tin</label>
                        <mat-chip style="background-color: #e3e5e6;" *ngFor="let file of lstUploadedFiles; let index = index"
                            [removable]="true" (removed)="remove(file.AttachmentName, index)">
                            {{file.AttachmentName}}
                            <mat-icon matChipRemove>cancel</mat-icon>
                        </mat-chip>
                    </mat-chip-list>
                </div>
            </div>
            <br>
            <div class="form-group row">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th class="text-center col-1">STT</th>
                            <th class="text-center col-10">Tên file</th>
                            <th class="text-center col-1">Thao tác</th>
                        </tr>
                    </thead>
                    <tbody formArrayName="listDVFileVM">
                        <tr *ngFor="let itemLD of listFileControls; let i = index" [formGroupName]="i">
                            <td class="text-center" style="font-weight: bold;"></td>
                            <td><input type="text" class="form-control" style="width: 100%;" name="fileName"
                                    formControlName="fileName"></td>
                            <td class="text-center">
                                <a class="add" title="Add" data-toggle="tooltip"
                                    (click)="downloadFile(doanVao.listDVFileVM[i].id, doanVao.listDVFileVM[i].fileName)"><i class="material-icons">file_download</i></a>
                                <a class="delete" title="Delete" data-toggle="tooltip" (click)="deleteRowFile(i,doanVao.listDVFileVM[i].id)"><i
                                        class="material-icons">&#xE872;</i></a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>   
            
            <br>
            <div class="form-group row">
                <h6 style="font-weight: bold;">Lãnh đạo tiếp đoàn</h6>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th class="text-center col-1">STT</th>
                            <th class="text-center col-10">Họ và tên</th>
                            <th class="text-center col-1">Thao tác</th>
                        </tr>
                    </thead>
                    <tbody formArrayName="jsonLanhDao">
                        <tr *ngFor="let itemLD of lanhDaoControls; let i = index" [formGroupName]="i">
                            <td class="text-center" style="font-weight: bold;"></td>
                            <td><input type="text" class="form-control" style="width: 100%;" name="hoTen"
                                    formControlName="hoTen"></td>
                            <td style="display: none;"><input type="text" class="form-control" style="width: 100%;" name="iD" formControlName="iD" [ngModel]="0"></td>
                            <td class="text-center">
                                <a class="add" title="Add" data-toggle="tooltip" (click)="addTableLDTD()"><i
                                        class="material-icons">&#xE03B;</i></a>
                                <a class="delete" title="Delete" data-toggle="tooltip" (click)="deleteRowLDTD(i)"><i
                                        class="material-icons">&#xE872;</i></a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <br>
            <div class="form-group row">
                <h6 style="font-weight: bold;">Hoạt động tại các địa phương</h6>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th class="text-center col-1">STT</th>
                            <th class="text-center col-6">Địa phương</th>
                            <th class="text-center col-2">Từ ngày</th>
                            <th class="text-center col-2">Đến ngày</th>
                            <th class="text-center">Thao tác</th>
                        </tr>
                    </thead>
                    <tbody formArrayName="jsonHDTaiDP">
                        <tr *ngFor="let itemDP of diaPhuongControls; let i = index" [formGroupName]="i">
                            <td class="text-center" style="font-weight: bold;"></td>
                            <td><input type="text" class="form-control" style="width: 100%;" name="diaPhuong"
                                    formControlName="diaPhuong"></td>
                            <td><input type="text" class="form-control" style="width: 100%;" bsDatepicker
                                [bsConfig]="{ dateInputFormat: 'DD/MM/YYYY', showWeekNumbers: false }" name="tuNgay" id="tuNgay{{i}}"
                                    formControlName="tuNgay" (change)="isInvalidDateTuNgay($event,i)" (bsValueChange)="checkDateTuNgay($event,i)"
                                    (keypress)=" numberOnlywithForwardSlash($event)" maxlength="10"></td>
                            <td><input type="text" class="form-control" style="width: 100%;" bsDatepicker
                                [bsConfig]="{ dateInputFormat: 'DD/MM/YYYY', showWeekNumbers: false }" name="denNgay" id="denNgay{{i}}"
                                    formControlName="denNgay" (change)="isInvalidDateDenNgay($event,i)" (bsValueChange)="checkDateDenNgay($event,i)"
                                    (keypress)=" numberOnlywithForwardSlash($event)" maxlength="10"></td>
                            <td style="display: none;"><input type="text" class="form-control" style="width: 100%;" name="iD" formControlName="iD" [ngModel]="0"></td>
                            <td class="text-center">
                                <a class="add" title="Add" data-toggle="tooltip" (click)="addTableHDTCDP()"><i
                                        class="material-icons">&#xE03B;</i></a>
                                <a class="delete" title="Delete" data-toggle="tooltip" (click)="deleteRowHDTCDP(i)"><i class="material-icons delete">delete</i></a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="d-flex justify-content-end">
                <button class="btn btn-primary jh-create-entity buttonborder" type="submit"
                 data-cy="submit" style="margin-right: 1%;color: white;" [disabled]="editForm.invalid">
                    <fa-icon class="bi bi-floppy-fill iconColor"></fa-icon>
                    <span class="iconColor">Cập nhật</span>
                </button>

                <button class="btn btn-primary jh-create-entity buttonborder" [routerLink]="['/doanVao/quanLyDoanVao']">
                    <fa-icon class="bi bi-box-arrow-left iconColor"></fa-icon>
                    <span class="iconColor">Quay lại</span>
                  </button>
            </div>
        </div>
    </form>
</div>

<app-alert></app-alert>